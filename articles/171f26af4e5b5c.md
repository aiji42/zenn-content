---
title: "ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®šç¾©ã¯i18nextã§æ¥½ã—ã‚ˆã†ãœ"
emoji: "ğŸ’"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [zod, i18n, i18next]
published: false
---

ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹å ´åˆã€æœ€è¿‘ã¯å€‹äººçš„ã«ã¯ `react-hook-form` ã¨ `zod` ã‚’ä½¿ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå¤šã„ã€‚

ã“ã®2ã¤ã®çµ„ã¿åˆã‚ã›ã«é–¢ã™ã‚‹è§£èª¬ã¯ä»–ã®æ–¹ã®è¨˜äº‹ã«è­²ã‚‹ã€‚

https://zenn.dev/uzimaru0000/articles/react-hook-form-with-zod

ã“ã‚“ãªæ„Ÿã˜ã§ã€ç°¡å˜ã«ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šãŒã§ãã¦ã€ãƒ•ã‚©ãƒ¼ãƒ ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚

```tsx
const schema = z.object({
  username: z
    .string()
    .min(3, "3æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(10, "10æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  email: z.string().email("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  favoriteNumber: z
    .number()
    .max(10, "10ä»¥ä¸‹ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .min(1, "1ä»¥ä¸Šã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"),
});

const Form = () => {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm({
    resolver: zodResolver(schema),
  });
  
  return (
    <form onSubmit={handleSubmit(console.log)}>
      <FormControl isInvalid={!!errors.username} mb={4}>
        <FormLabel htmlFor="username">ãƒ¦ãƒ¼ã‚¶å</FormLabel>
        <Input id="username" {...register("username")} />
        <FormErrorMessage>{(errors.username?.message ?? "")}</FormErrorMessage>
      </FormControl>
      {/* çœç•¥ */}
    </form>
  )
}
```

![](/images/zod-form.png)

## zodã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®šç¾©ã¯é¢å€’

ã“ã®ä¸Šãªãä¾¿åˆ©ãªçµ„ã¿åˆã‚ã›ã ãŒã€å”¯ä¸€ã®ä¸æº€ã¯ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã—ãªã„ã¨ã„ã‘ãªã„ã¨ã“ã‚ã ã€‚  
ã“ã‚“ãªæ„Ÿã˜ã§ä¸€ã¤ä¸€ã¤ã®æ¡ä»¶ã«å¯¾ã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰²ã‚Šå½“ã¦ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚  
ã¾ãŸã€Œ3æ–‡å­—ã€ã¨ã‹ã€Œ10ä»¥ä¸‹ã€ã¨ã‹ã€æ¡ä»¶ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒ™ã‚¿ã§å«ã‚ãªã„ã¨ã„ã‘ãªã„ã®ã‚‚ã€è‹¥å¹²ã‚‚ã‚„ã£ã¨ã™ã‚‹ã¨ã“ã‚ã€‚

```ts
const schema = z.object({
  username: z
    .string()
    .min(3, "3æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„")
    .max(10, "10æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  email: z.string().email("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„"),
  favoriteNumber: z
    .number()
    .max(10, "10ä»¥ä¸‹ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
    .min(1, "1ä»¥ä¸Šã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"),
});
```

ã“ã®å®šç¾©ã‚’çœç•¥ã™ã‚‹äº‹ã‚‚ã§ãã‚‹ãŒã€è‹±èªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€æ—¥æœ¬äººã«å¯¾ã—ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾›ã‚’å‰æã¨ã™ã‚‹ã®ã§ã‚ã‚Œã°ã€ã“ã®æ‰‹é–“ã‚’çœãã“ã¨ã¯ã§ããªã„ã€‚  

![](/images/zod-form-default.png)

ã€Œè‹±èªã§ã‚ã‚Œã°å®šç¾©ãŒçœã‘ã‚‹ã®ã«ãªãƒ¼...ã€ã¨ã€è‡ªåˆ†ãŒè‹±èªåœã®äººé–“ã§ãªã„ã“ã¨ãŒè‹¥å¹²æ‚”ã—ã„æ°—æŒã¡ã«ãªã‚‹ã€‚

ã¾ãŸã€å®Ÿéš›ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã‚‚ã£ã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ•°ãŒå¤šã‹ã£ãŸã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸­ã§ã„ãã¤ã‹ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ç®¡ç†ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ã‚‚ã‚ã‚‹ã®ã§ã€è¤‡é›‘ã§ã‚ã‚‹ä¸Šã«è¡¨è¨˜ã‚†ã‚Œã®å•é¡Œã‚‚è€ƒæ…®ã—ãªã‘ã‚Œã°ãªã‚‰ãªããªã‚‹ã€‚

Railsã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã£ã¦ã„ãŸé ƒã¯ã“ã†ã„ã£ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’i18nã®è¾æ›¸yamlã§ç®¡ç†ã—ã¦ã„ãŸçµŒé¨“ã®ã›ã„ã‹ã€ã“ã†ã„ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç›´æ¥ã‚³ãƒ¼ãƒ‰å†…ã«æ›¸ãã®ã¯å€‹äººçš„ã«å¥½ãã§ã¯ãªã„ã€‚

ãªã®ã§ã€i18nã®ä»•çµ„ã¿ã‚’ä½¿ã£ã¦ã„ã„æ„Ÿã˜ã«ã§ããªã„ã‹ã¨æ¢ã—ã¦ã¿ãŸãŒã€æ®‹å¿µãªãŒã‚‰zodã®i18nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒãªã‹ã£ãŸã®ã§è‡ªåˆ†ã§ä½œã£ãŸã€‚

## zod + i18next

![](https://raw.githubusercontent.com/aiji42/zod-i18n/main/images/hero.png)

https://github.com/aiji42/zod-i18n

å†…éƒ¨çš„ã«ã¯ã€zodã®ã‚¨ãƒ©ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ [i18next](https://www.i18next.com/) ã§è§£é‡ˆå¯èƒ½ãªãƒ•ãƒ©ãƒƒãƒˆãªã‚­ãƒ¼ã«å¤‰æ›ã—ã¦ã€ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¼•ãå½“ã¦ã‚‹ã¨ã„ã†ç°¡å˜ãªä»•çµ„ã¿ã€‚

https://www.i18next.com/

ã“ã‚Œã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®šç¾©ã‚’çœãã“ã¨ãŒã§ãã‚‹ã€‚
```tsx
import i18next from 'i18next'
import { z } from 'zod'
import { zodI18nMap } from "zod-i18n-map"
import translation from 'zod-i18n-map/locales/ja/zod.json'

i18next.init({
  lng: 'ja',
  resources: {
    ja: { zod: translation },
  },
});
z.setErrorMap(zodI18nMap);

const schema = z.object({
  username: z.string().min(3).max(10),
  email: z.string().email(),
  favoriteNumber: z.number().max(10).min(1),
});

const Form = () => {
  // çœç•¥
}
```

å®Ÿéš›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å®šç¾©ã¯ã“ã‚“ãªæ„Ÿã˜ã§JSONã§å®šç¾©ã—ã¦ãŠãã€‚  

https://github.com/aiji42/zod-i18n/blob/main/packages/core/locales/ja/zod.json#L1-L19

ã“ã‚Œã¯Zodã®å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ãŸã‚ã®ã‚‚ã®ãªã®ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ä½¿ç”¨ã—ãªã„ã‚ˆã†ãªã‚‚ã®ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ã€‚  
ä¸è¦ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šã£ãŸã‚Šã€ã‚‚ã†å°‘ã—ä¼šè©±èª¿ã§ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰ãˆã¦ã‚‚ã‚ˆã—ã€‚

---

å®Ÿéš›ã«å‹•ã„ã¦ã„ã‚‹æ§˜å­ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚  
`next-i18next` ãªã©ã¨ä½µç”¨ã™ã‚Œã°ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ©ãƒ™ãƒ«åãªã©ã‚‚ç›´æ›¸ãã—ãªãã¦æ¸ˆã‚€ã®ã§ã€è¡¨è¨˜ã‚†ã‚Œå¯¾ç­–ã¨ã—ã¦ã‚‚ã‚ˆã„ã€‚

https://zod-i18n.vercel.app/ja

:::details ã‚½ãƒ¼ã‚¹
```tsx
import { useForm } from "react-hook-form";
import {
  FormErrorMessage,
  FormLabel,
  FormControl,
  Input,
  Button,
  Select,
  InputGroup,
  InputLeftAddon,
  Container,
  Flex,
  Heading,
  Spacer,
} from "@chakra-ui/react";
import { zodResolver } from "@hookform/resolvers/zod";
import z from "zod";
import { makeZodI18nMap } from "zod-i18n-map";
import { GetServerSideProps } from "next";
import { serverSideTranslations } from "next-i18next/serverSideTranslations";
import { useTranslation, Trans } from "next-i18next";
import { useRouter } from "next/router";
import { setCookie } from "nookies";
import { ChangeEventHandler, useCallback } from "react";

export const getServerSideProps: GetServerSideProps = async ({ locale }) => {
  return {
    props: {
      ...(await serverSideTranslations(locale!, ["common", "zod"])),
    },
  };
};

const schema = z.object({
  username: z.string().min(5),
  email: z.string().email(),
  favoriteNumber: z.number().max(10).min(1),
});

export default function HookForm() {
  const { t } = useTranslation();
  z.setErrorMap(makeZodI18nMap({ t, handlePath: { ns: ["common", "zod"] } }));
  const router = useRouter();

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm({
    resolver: zodResolver(schema),
  });

  const changeLocale = useCallback<ChangeEventHandler<HTMLSelectElement>>(
    (e) => {
      const locale = e.currentTarget.value;
      setCookie(null, "NEXT_LOCALE", locale);
      router.replace("/", "/", { locale }).then(() => {
        router.reload();
      });
    },
    [router.replace, router.reload]
  );

  return (
    <Container maxW="container.xl">
      <Flex as="header" py="4" justifyContent="space-between">
        <a href="https://github.com/aiji42/zod-i18n" rel="noopener noreferrer">
          <Heading as="h1" fontSize="xl" color="gray.600">
            zod-i18n-map
          </Heading>
        </a>
        <InputGroup maxW="3xs">
          <InputLeftAddon>ğŸŒ</InputLeftAddon>
          <Select
            defaultValue={router.locale}
            onChange={changeLocale}
            borderLeftRadius={0}
          >
            <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            <option value="es">Spanish</option>
            <option value="en">English</option>
            <option value="fr">FranÃ§ais</option>
            <option value="is">Icelandic</option>
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="pt">PortuguÃªs</option>
            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
          </Select>
        </InputGroup>
      </Flex>
      <form onSubmit={handleSubmit(console.log)}>
        <FormControl isInvalid={!!errors.username} mb={4}>
          <FormLabel htmlFor="username">
            <Trans>username</Trans>
          </FormLabel>
          <Input
            id="username"
            placeholder={t("username_placeholder") ?? undefined}
            {...register("username")}
          />
          <FormErrorMessage>
            {(errors.username?.message ?? "") as string}
          </FormErrorMessage>
        </FormControl>
        <FormControl isInvalid={!!errors.email} mb={4}>
          <FormLabel htmlFor="email">
            <Trans>email</Trans>
          </FormLabel>
          <Input
            id="email"
            placeholder="foo@example.com"
            {...register("email")}
          />
          <FormErrorMessage>
            {(errors.email?.message ?? "") as string}
          </FormErrorMessage>
        </FormControl>
        <FormControl isInvalid={!!errors.favoriteNumber} mb={4}>
          <FormLabel htmlFor="favoriteNumber">
            <Trans>favoriteNumber</Trans>
          </FormLabel>
          <Input
            id="favoriteNumber"
            {...register("favoriteNumber", { setValueAs: Number })}
          />
          <FormErrorMessage>
            {(errors.favoriteNumber?.message ?? "") as string}
          </FormErrorMessage>
        </FormControl>
        <Button
          mt={4}
          colorScheme="teal"
          isLoading={isSubmitting}
          type="submit"
        >
          <Trans>submit</Trans>
        </Button>
      </form>
    </Container>
  );
}
```
:::

## ãŠã¾ã‘

`zod` æœ¬ä½“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãƒªãƒ³ã‚¯ã‚’è¼‰ã›ã‚‹PRã‚’ãŠãã£ãŸã¨ã“ã‚ã€ã‚ã‚ŠãŒãŸã„ã“ã¨ã«ã‚ªãƒ¼ãƒŠãƒ¼ã‹ã‚‰ã€Œi18nã«ã¤ã„ã¦åˆ¥é€”è©±ã‚’ã—ã‚ˆã†ã€ã¨è¨€ã‚ã‚ŒãŸã®ã§ã€zodæœ¬ä½“ã«å–ã‚Šè¾¼ã‚“ã§ã‚‚ã‚‰ã£ã¦ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã™ã‚‹ã“ã¨ã‚’æ¥å¹´ã®ç›®æ¨™ã¨ã—ãŸã„ã€‚
![](/images/zod-owner.png)
![](/images/zod-eco-link.png)